window.__require=function e(t,a,i){function c(l,r){if(!a[l]){if(!t[l]){var o=l.split("/");if(o=o[o.length-1],!t[o]){var n="function"==typeof __require&&__require;if(!r&&n)return n(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+l+"'")}}var h=a[l]={exports:{}};t[l][0].call(h.exports,function(e){return c(t[l][1][e]||e)},h,h.exports,e,t,a,i)}return a[l].exports}for(var s="function"==typeof __require&&__require,l=0;l<i.length;l++)c(i[l]);return c}({gameLayer:[function(e,t,a){"use strict";cc._RF.push(t,"8bdddCze2RD97IUN7F/EblH","gameLayer");var i=0,c=1,s=2,l=3,r=4,o=5,n=6,h="Texture/sound/button",u="Texture/sound/gamewin";cc.Class({extends:cc.Component,properties:{bg:cc.Node,menuLayer:cc.Node,levelLayer:cc.Node,gameLayer:cc.Node,gameControlLayer:cc.Node,gameOverLayer:cc.Node,startBtn:cc.Node,titleImg:cc.Node,iconImg:cc.Node,loadingTxt:cc.Node,levelScroll:cc.Node,levelContent:cc.Node,levelTxt:cc.Node,curNum:cc.Node,bestNum:cc.Node,itemImgAtlas:cc.SpriteAtlas,levelImgAtlas:cc.SpriteAtlas,levelItemPrefab:cc.Prefab},onLoad:function(){this.curLayer=0,this.clearGameData(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),this.initData(),this.menuLayer.active=!0,this.levelLayer.active=!1,this.gameLayer.active=!1,this.gameOverLayer.active=!1,this.loadingTxt.active=!0,this.startBtn.getComponent(cc.Button).interactable=!1,this.menuLayerAni()},initData:function(){this.boxWidth=90,this.boxHeight=90,this.allWidth=720,this.allHeight=1280,this.allRow=8,this.allCol=8,this.allLevelCount=0,this.allLevelConfig={},cc.loader.loadRes("levelConfig.json",function(e,t){e?console.log(e):(this.allLevelConfig=t.json.level,this.allLevelCount=t.json.levelCount,this.loadingTxt.active=!1,this.startBtn.getComponent(cc.Button).interactable=!0,this.createLavelItem())}.bind(this)),this.tabLevel=[]},onKeyDown:function(e){var t=cc.macro;switch(e.keyCode){case t.KEY.a:case t.KEY.left:this.runHero("left");break;case t.KEY.d:case t.KEY.right:this.runHero("right");break;case t.KEY.w:case t.KEY.up:this.runHero("up");break;case t.KEY.s:case t.KEY.down:this.runHero("down")}},createLavelItem:function(){for(var e=this,t=function(t){e.selectLevelCallBack(t)},a=0;a<this.allLevelCount;a++){var i=cc.instantiate(this.levelItemPrefab);i.parent=this.levelScroll;var c=i.getComponent("levelItem");c.levelFunc(t),this.tabLevel.push(c)}this.levelContent.height=135*Math.ceil(this.allLevelCount/5)+20},updateLevelInfo:function(){for(var e=parseInt(cc.sys.localStorage.getItem("finishLevel")||0),t=1;t<=this.allLevelCount;t++)if(t<=e){var a=parseInt(cc.sys.localStorage.getItem("levelStar"+t)||0);this.tabLevel[t-1].showStar(!0,a,this.levelImgAtlas,t)}else t==e+1?this.tabLevel[t-1].showStar(!0,0,this.levelImgAtlas,t):this.tabLevel[t-1].showStar(!1,0,this.levelImgAtlas,t)},menuLayerAni:function(){this.startBtn.scale=1,this.startBtn.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.6,1.5),cc.scaleTo(.6,1))))},startBtnCallBack:function(e,t){var a=this;1!=this.curLayer&&(this.curLayer=1,this.playSound(h),this.menuLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){a.startBtn.stopAllActions(),a.startBtn.scale=1,a.menuLayer.opacity=255,a.menuLayer.active=!1}))),this.levelLayer.active=!0,this.levelLayer.opacity=0,this.levelLayer.runAction(cc.sequence(cc.delayTime(.1),cc.fadeIn(.1),cc.callFunc(function(){a.updateLevelInfo()}))))},levelBackCallBack:function(e,t){0!=this.curLayer&&(this.playSound(h),this.curLayer=0,this.levelLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.levelLayer.opacity=255,this.levelLayer.active=!1},this))),this.menuLayer.active=!0,this.menuLayer.opacity=0,this.menuLayer.runAction(cc.sequence(cc.delayTime(.1),cc.fadeIn(.1))),this.menuLayerAni())},selectLevelCallBack:function(e){this.curLevel=e,2!=this.curLayer&&(this.playSound(h),this.curLayer=2,this.levelLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.levelLayer.opacity=255,this.levelLayer.active=!1},this))),this.gameLayer.active=!0,this.gameLayer.opacity=0,this.gameLayer.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){this.createLevelLayer(e)},this),cc.fadeIn(.1))))},backLevelCallBack:function(e,t){this.clearGameData(),1!=this.curLayer&&(this.playSound(h),this.curLayer=1,this.gameLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.gameLayer.opacity=255,this.gameLayer.active=!1},this))),this.levelLayer.active=!0,this.levelLayer.opacity=0,this.levelLayer.runAction(cc.sequence(cc.fadeIn(.1),cc.callFunc(function(){this.updateLevelInfo()},this))))},nextLevelCallBack:function(e,t){this.playSound(h),this.gameOverLayer.active=!1,this.curLevel=this.curLevel+1,this.curLevel>this.allLevelCount?this.backLevelCallBack():this.createLevelLayer(this.curLevel)},refreshCallBack:function(e,t){this.playSound(h),this.gameLayer.stopAllActions(),this.clearGameData(),this.createLevelLayer(this.curLevel)},revokeCallBack:function(e,t){},createLevelLayer:function(e){this.gameControlLayer.removeAllChildren(),this.setLevel(),this.setCurNum(),this.setBestNum();var t=this.allLevelConfig[e].content;this.allRow=this.allLevelConfig[e].allRow,this.allCol=this.allLevelConfig[e].allCol,this.heroRow=this.allLevelConfig[e].heroRow,this.heroCol=this.allLevelConfig[e].heroCol,this.boxW=this.allWidth/this.allCol,this.boxH=this.boxW;var a=-this.allWidth/2+this.boxW/2,i=this.allWidth/2-this.boxW/2,c=0;c=(this.allRow,this.allCol,(this.allRow-this.allCol)*this.boxH/2),this.landArrays=[],this.palace=[];for(var s=0;s<this.allRow;s++)this.landArrays[s]=[],this.palace[s]=[];for(var l=0;l<this.allRow;l++)for(var r=0;r<this.allCol;r++){var o=a+this.boxW*r,h=i-this.boxH*l+c,u=this.createBoxItem(l,r,t[l*this.allCol+r],cc.v2(o,h));this.landArrays[l][r]=u,u.width=this.boxW,u.height=this.boxH}this.setLandFrame(this.heroRow,this.heroCol,n)},createBoxItem:function(e,t,a,s){var l=new cc.Node;return l.addComponent(cc.Sprite).spriteFrame=this.itemImgAtlas.getSpriteFrame("p"+a),l.parent=this.gameControlLayer,l.position=s,a==c?(l.name="wall_"+e+"_"+t,l.attr({_type_:a})):a==i?(l.name="none_"+e+"_"+t,l.attr({_type_:a})):(l.name="land_"+e+"_"+t,l.attr({_type_:a}),l.attr({_row_:e}),l.attr({_col_:t}),a==o&&(this.finishBoxCount+=1)),this.palace[e][t]=a,l},runHero:function(e){this.start.row=this.heroRow,this.start.col=this.heroCol,"up"==e?this.checkNextMove(this.start.row-1,this.start.col):"down"==e?this.checkNextMove(this.start.row+1,this.start.col):"left"==e?this.checkNextMove(this.start.row,this.start.col-1):"right"==e&&this.checkNextMove(this.start.row,this.start.col+1)},checkNextMove:function(e,t){var a=this.palace[e][t];if(a==s||a==l)this.heroRow=e,this.heroCol=t,this.setLandFrame(e,t,n),this.setLandFrame(this.start.row,this.start.col,this.palace[this.start.row][this.start.col]);else if(a==r||a==o){var i=e-this.start.row,h=t-this.start.col;if(Math.abs(i)+Math.abs(h)==1){var u=e+i,v=t+h,m=this.palace[u][v];if(m&&m!=c&&m!=r&&m!=o)this.setLandFrame(this.start.row,this.start.col,this.palace[this.start.row][this.start.col]),this.palace[e][t]==o?(this.palace[e][t]=l,this.finishBoxCount-=1):this.palace[e][t]=s,this.setLandFrame(e,t,n),this.palace[u][v]==l?(this.palace[u][v]=o,this.finishBoxCount+=1):this.palace[u][v]=r,this.setLandFrame(u,v,this.palace[u][v]),this.heroRow=e,this.heroCol=t,this.checkGameOver()}}},setLandFrame:function(e,t,a){var i=this.landArrays[e][t];i&&(i.getComponent(cc.Sprite).spriteFrame=this.itemImgAtlas.getSpriteFrame("p"+a),i.width=this.boxW,i.height=this.boxH)},checkGameOver:function(){var e=this.allLevelConfig[this.curLevel].allBox;if(this.finishBoxCount==e){this.gameOverLayer.active=!0,this.gameOverLayer.opacity=1,this.gameOverLayer.runAction(cc.sequence(cc.delayTime(.5),cc.fadeIn(.1)));var t=parseInt(cc.sys.localStorage.getItem("finishLevel")||0);this.curLevel>t&&cc.sys.localStorage.setItem("finishLevel",this.curLevel),cc.sys.localStorage.setItem("levelStar"+this.curLevel,3);var a=parseInt(cc.sys.localStorage.getItem("levelBest"+this.curLevel)||0);(this.curStepNum<a||0==a)&&cc.sys.localStorage.setItem("levelBest"+this.curLevel,this.curStepNum),this.playSound(u),this.clearGameData()}},setLevel:function(){this.levelTxt.getComponent(cc.Label).string=this.curLevel},setCurNum:function(){this.curNum.getComponent(cc.Label).string=this.curStepNum},setBestNum:function(){var e=cc.sys.localStorage.getItem("levelBest"+this.curLevel)||"--";this.bestNum.getComponent(cc.Label).string=e},clearGameData:function(){this.finishBoxCount=0,this.curStepNum=0,this.curStepNum=0},playSound:function(e){cc.loader.loadRes(e,cc.AudioClip,function(e,t){cc.audioEngine.playEffect(t,!1)})},start:function(){}}),cc._RF.pop()},{}],levelItem:[function(e,t,a){"use strict";cc._RF.push(t,"ae408IqDF5DFo8na+52hGjt","levelItem"),cc.Class({extends:cc.Component,properties:{starImg:cc.Node,itemBg:cc.Node,levelTxt:cc.Node},onLoad:function(){},showStar:function(e,t,a,i){this.itemBg.attr({_level_:i}),e?(this.itemBg.getComponent(cc.Sprite).spriteFrame=a.getSpriteFrame("pass_bg"),this.starImg.active=!0,this.starImg.getComponent(cc.Sprite).spriteFrame=a.getSpriteFrame("point"+t),this.levelTxt.opacity=255,this.itemBg.getComponent(cc.Button).interactable=!0):(this.itemBg.getComponent(cc.Sprite).spriteFrame=a.getSpriteFrame("lock"),this.starImg.active=!1,this.levelTxt.opacity=125,this.itemBg.getComponent(cc.Button).interactable=!1),this.levelTxt.getComponent(cc.Label).string=i},btnCallBack:function(e,t){this._callfunc&&this._callfunc(this.itemBg._level_)},levelFunc:function(e){this._callfunc=e}}),cc._RF.pop()},{}]},{},["gameLayer","levelItem"]);