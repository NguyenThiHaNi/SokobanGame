{"version":3,"sources":["gameLayer.js"],"names":["boxType","NONE","WALL","LAND","BODY","BOX","ENDBOX","HERO","sound","BUTTON","GAMEWIN","MOVE","PUSHBOX","WRONG","cc","Class","extends","Component","properties","bg","Node","menuLayer","levelLayer","gameLayer","gameControlLayer","gameOverLayer","startBtn","titleImg","iconImg","loadingTxt","levelScroll","levelContent","levelTxt","curNum","bestNum","itemImgAtlas","SpriteAtlas","levelImgAtlas","levelItemPrefab","Prefab","onLoad","curLayer","clearGameData","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","initData","active","getComponent","Button","interactable","menuLayerAni","boxWidth","boxHeight","allWidth","allHeight","allRow","allCol","allLevelCount","allLevelConfig","loader","loadRes","err","object","console","log","json","level","levelCount","createLavelItem","bind","tabLevel","event","macro","keyCode","KEY","a","left","runHero","d","right","w","up","s","down","callfunc","selectLevelCallBack","i","node","instantiate","parent","levelItem","levelFunc","push","height","Math","ceil","updateLevelInfo","finishLevel","parseInt","sys","localStorage","getItem","data","showStar","scale","runAction","repeatForever","sequence","scaleTo","startBtnCallBack","customEventData","playSound","fadeOut","callFunc","stopAllActions","opacity","delayTime","fadeIn","levelBackCallBack","curLevel","createLevelLayer","backLevelCallBack","nextLevelCallBack","refreshCallBack","revokeCallBack","removeAllChildren","setLevel","setCurNum","setBestNum","content","heroRow","heroCol","boxW","boxH","sPosX","sPosY","offset","landArrays","palace","j","x","y","createBoxItem","v2","width","setLandFrame","row","col","type","pos","sprite","addComponent","Sprite","spriteFrame","getSpriteFrame","position","name","attr","finishBoxCount","move","start","checkNextMove","next_row","next_col","t","lr","lc","abs","nextr","nextc","t2","bt","nt","checkGameOver","land","count","allBox","setItem","best","curStepNum","Label","string","AudioClip","clip","audioID","audioEngine","playEffect"],"mappings":"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","file":"gameLayer.js","sourceRoot":"../../../../assets/Script","sourcesContent":["let boxType = {\n    NONE: 0,   \n    WALL: 1,   \n    LAND: 2,   \n    BODY: 3,   \n    BOX: 4,    \n    ENDBOX: 5, \n    HERO: 6    \n}\n\nlet sound = {\n    BUTTON: \"Texture/sound/button\",      \n    GAMEWIN: \"Texture/sound/gamewin\",    \n    MOVE: \"Texture/sound/move\",         \n    PUSHBOX: \"Texture/sound/pushbox\",    \n    WRONG: \"Texture/sound/wrong\",        \n}\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bg: cc.Node,\n        menuLayer: cc.Node,    \n        levelLayer: cc.Node,   \n        gameLayer: cc.Node,    \n        gameControlLayer: cc.Node, \n        gameOverLayer: cc.Node,   \n\n        startBtn: cc.Node,\n        titleImg: cc.Node,\n        iconImg: cc.Node,\n        loadingTxt: cc.Node,\n\n        levelScroll: cc.Node,\n        levelContent: cc.Node,\n\n        levelTxt: cc.Node,\n        curNum: cc.Node,\n        bestNum: cc.Node,\n\n        itemImgAtlas: cc.SpriteAtlas,\n        levelImgAtlas: cc.SpriteAtlas,\n\n        levelItemPrefab: cc.Prefab,\n    },\n\n    onLoad: function () {\n        this.curLayer = 0; \n        this.clearGameData();\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        this.initData();\n        this.menuLayer.active = true;\n        this.levelLayer.active = false;\n        this.gameLayer.active = false;\n        this.gameOverLayer.active = false;\n        this.loadingTxt.active = true;\n        this.startBtn.getComponent(cc.Button).interactable = false;\n        this.menuLayerAni();\n    },\n\n    initData: function () {\n        this.boxWidth = 90;\n        this.boxHeight = 90;\n        this.allWidth = 720;\n        this.allHeight = 1280;\n        this.allRow = 8;\n        this.allCol = 8;\n\n        this.allLevelCount = 0;\n        this.allLevelConfig = {};\n        cc.loader.loadRes('levelConfig.json', function (err, object) {\n            if (err) {\n                console.log(err);\n                return;\n            }\n            this.allLevelConfig = object.json.level;\n            this.allLevelCount = object.json.levelCount;\n            this.loadingTxt.active = false;\n            this.startBtn.getComponent(cc.Button).interactable = true;\n            this.createLavelItem();\n        }.bind(this));\n\n        this.tabLevel = [];\n    },\n    onKeyDown(event) {\n        var macro = cc.macro;\n        switch (event.keyCode) {\n            case macro.KEY.a:\n            case macro.KEY.left:\n                this.runHero(\"left\");\n                break;\n            case macro.KEY.d:\n            case macro.KEY.right:\n                this.runHero(\"right\");\n                break;\n            case macro.KEY.w:\n            case macro.KEY.up:\n                this.runHero(\"up\");\n                break;\n            case macro.KEY.s:\n            case macro.KEY.down:\n                this.runHero(\"down\");\n                break;\n        }\n    },\n    createLavelItem() {\n        let callfunc = level => {\n            this.selectLevelCallBack(level);\n        };\n\n        for (let i = 0; i < this.allLevelCount; i++) {\n            let node = cc.instantiate(this.levelItemPrefab);\n            node.parent = this.levelScroll;\n            let levelItem = node.getComponent(\"levelItem\");\n            levelItem.levelFunc(callfunc);\n            this.tabLevel.push(levelItem);\n        }\n        this.levelContent.height = Math.ceil(this.allLevelCount / 5) * 135 + 20;\n    },\n\n    updateLevelInfo() {\n        let finishLevel = parseInt(cc.sys.localStorage.getItem(\"finishLevel\") || 0);\n        for (let i = 1; i <= this.allLevelCount; i++) {\n            if (i <= finishLevel) {\n                let data = parseInt(cc.sys.localStorage.getItem(\"levelStar\" + i) || 0);\n                this.tabLevel[i - 1].showStar(true, data, this.levelImgAtlas, i);\n            }\n            else if (i == (finishLevel + 1)) {\n                this.tabLevel[i - 1].showStar(true, 0, this.levelImgAtlas, i);\n            }\n            else {\n                this.tabLevel[i - 1].showStar(false, 0, this.levelImgAtlas, i);\n            }\n        }\n    },\n\n    menuLayerAni() {\n        this.startBtn.scale = 1.0;\n        this.startBtn.runAction(cc.repeatForever(cc.sequence(\n            cc.scaleTo(0.6, 1.5),\n            cc.scaleTo(0.6, 1.0)\n        )));\n    },\n\n    startBtnCallBack(event, customEventData) {\n        if (this.curLayer == 1) {\n            return;\n        }\n        this.curLayer = 1;\n\n        this.playSound(sound.BUTTON);\n\n        this.menuLayer.runAction(cc.sequence(\n            cc.fadeOut(0.1),\n            cc.callFunc(() => {\n                this.startBtn.stopAllActions();\n                this.startBtn.scale = 1.0;\n                this.menuLayer.opacity = 255;\n                this.menuLayer.active = false;\n            }\n            )));\n\n        this.levelLayer.active = true;\n        this.levelLayer.opacity = 0;\n        this.levelLayer.runAction(cc.sequence(\n            cc.delayTime(0.1),\n            cc.fadeIn(0.1),\n            cc.callFunc(() => {\n                this.updateLevelInfo();\n            }\n            )));\n    },\n\n    levelBackCallBack: function (event, customEventData) {\n        if (this.curLayer == 0) {\n            return;\n        }\n        this.playSound(sound.BUTTON);\n        this.curLayer = 0;\n        this.levelLayer.runAction(cc.sequence(cc.fadeOut(0.1), cc.callFunc(function () {\n            this.levelLayer.opacity = 255;\n            this.levelLayer.active = false;\n        }, this)));\n\n        this.menuLayer.active = true;\n        this.menuLayer.opacity = 0;\n        this.menuLayer.runAction(cc.sequence(cc.delayTime(0.1), cc.fadeIn(0.1)));\n        this.menuLayerAni();\n    },\n\n    selectLevelCallBack: function (level) {\n        this.curLevel = level;\n        if (this.curLayer == 2) {\n            return;\n        }\n        this.playSound(sound.BUTTON);\n        this.curLayer = 2;\n        this.levelLayer.runAction(cc.sequence(cc.fadeOut(0.1), cc.callFunc(function () {\n            this.levelLayer.opacity = 255;\n            this.levelLayer.active = false;\n        }, this)));\n\n        this.gameLayer.active = true;\n        this.gameLayer.opacity = 0;\n        this.gameLayer.runAction(cc.sequence(cc.delayTime(0.1), cc.callFunc(function () {\n            this.createLevelLayer(level);\n        }, this), cc.fadeIn(0.1)));\n    },\n\n    backLevelCallBack: function (event, customEventData) {\n        this.clearGameData();\n        if (this.curLayer == 1) {\n            return;\n        }\n        this.playSound(sound.BUTTON);\n        this.curLayer = 1;\n        this.gameLayer.runAction(cc.sequence(cc.fadeOut(0.1), cc.callFunc(function () {\n            this.gameLayer.opacity = 255;\n            this.gameLayer.active = false;\n        }, this)));\n\n        this.levelLayer.active = true;\n        this.levelLayer.opacity = 0;\n        this.levelLayer.runAction(cc.sequence(cc.fadeIn(0.1), cc.callFunc(function () {\n            this.updateLevelInfo();\n        }, this)));\n    },\n\n    nextLevelCallBack(event, customEventData) {\n        this.playSound(sound.BUTTON);\n        this.gameOverLayer.active = false;\n\n        this.curLevel = this.curLevel + 1;\n        if (this.curLevel > this.allLevelCount) {\n            this.backLevelCallBack();\n        }\n        else {\n            this.createLevelLayer(this.curLevel);\n        }\n    },\n\n    refreshCallBack: function (event, customEventData) {\n        this.playSound(sound.BUTTON);\n        this.gameLayer.stopAllActions();\n        this.clearGameData();\n        this.createLevelLayer(this.curLevel);\n    },\n\n    revokeCallBack: function (event, customEventData) {\n\n    },\n\n    createLevelLayer(level) {\n        this.gameControlLayer.removeAllChildren();\n        this.setLevel();\n        this.setCurNum();\n        this.setBestNum();\n\n        let levelContent = this.allLevelConfig[level].content;\n        this.allRow = this.allLevelConfig[level].allRow;\n        this.allCol = this.allLevelConfig[level].allCol;\n        this.heroRow = this.allLevelConfig[level].heroRow;\n        this.heroCol = this.allLevelConfig[level].heroCol;\n\n        this.boxW = this.allWidth / this.allCol;\n        this.boxH = this.boxW;\n\n        let sPosX = -(this.allWidth / 2) + (this.boxW / 2);\n        let sPosY = (this.allWidth / 2) - (this.boxW / 2);\n        let offset = 0;\n        if (this.allRow > this.allCol) {\n            offset = ((this.allRow - this.allCol) * this.boxH) / 2;\n        }\n        else {\n            offset = ((this.allRow - this.allCol) * this.boxH) / 2;\n        }\n        this.landArrays = [];  \n        this.palace = [];      \n        for (let i = 0; i < this.allRow; i++) {\n            this.landArrays[i] = [];\n            this.palace[i] = [];\n        }\n\n        for (let i = 0; i < this.allRow; i++) {    \n            for (let j = 0; j < this.allCol; j++) {   \n                let x = sPosX + (this.boxW * j);\n                let y = sPosY - (this.boxH * i) + offset;\n                let node = this.createBoxItem(i, j, levelContent[i * this.allCol + j], cc.v2(x, y));\n                this.landArrays[i][j] = node;\n                node.width = this.boxW;\n                node.height = this.boxH;\n            }\n        }\n\n        this.setLandFrame(this.heroRow, this.heroCol, boxType.HERO);\n    },\n\n\n    createBoxItem(row, col, type, pos) {\n        let node = new cc.Node();\n        let sprite = node.addComponent(cc.Sprite);\n        sprite.spriteFrame = this.itemImgAtlas.getSpriteFrame(\"p\" + type);\n        node.parent = this.gameControlLayer;\n        node.position = pos;\n        if (type == boxType.WALL) {  \n            node.name = \"wall_\" + row + \"_\" + col;\n            node.attr({ \"_type_\": type });\n        }\n        else if (type == boxType.NONE) {  \n            node.name = \"none_\" + row + \"_\" + col;\n            node.attr({ \"_type_\": type });\n        }\n        else { \n            node.name = \"land_\" + row + \"_\" + col;\n            node.attr({ \"_type_\": type });\n            node.attr({ \"_row_\": row });\n            node.attr({ \"_col_\": col });\n            if (type == boxType.ENDBOX) {  \n                this.finishBoxCount += 1;\n            }\n        }\n        this.palace[row][col] = type;\n\n        return node;\n    },\n\n    runHero: function (move) {\n        this.start.row = this.heroRow;\n        this.start.col = this.heroCol;\n        if (move == \"up\") {\n            this.checkNextMove(this.start.row - 1, this.start.col);\n        } else if (move == \"down\") {\n            this.checkNextMove(this.start.row + 1, this.start.col);\n        } else if (move == \"left\") {\n            this.checkNextMove(this.start.row, this.start.col - 1);\n        } else if (move == \"right\") {\n            this.checkNextMove(this.start.row, this.start.col + 1);\n        }\n\n    },\n    checkNextMove: function (next_row, next_col) {\n        let t = this.palace[next_row][next_col];\n        if(t == boxType.LAND || t == boxType.BODY) {\n            this.heroRow = next_row;\n            this.heroCol = next_col;\n            this.setLandFrame(next_row, next_col, boxType.HERO);\n            this.setLandFrame(this.start.row, this.start.col, this.palace[this.start.row][this.start.col]);\n        } else if(t == boxType.BOX || t == boxType.ENDBOX) {\n            let lr = next_row - this.start.row;\n            let lc = next_col - this.start.col;\n            if((Math.abs(lr) + Math.abs(lc)) == 1){\n                let nextr = next_row + lr;\n                let nextc = next_col + lc;\n                let t2 = this.palace[nextr][nextc];\n                if(t2 && (t2 != boxType.WALL) && (t2 != boxType.BOX) && (t2 != boxType.ENDBOX)) {\n                    this.setLandFrame(this.start.row, this.start.col, this.palace[this.start.row][this.start.col]);\n                    let bt = this.palace[next_row][next_col];\n                    if(bt == boxType.ENDBOX){    \n                        this.palace[next_row][next_col] = boxType.BODY;\n                        this.finishBoxCount -= 1;\n                    } else {\n                        this.palace[next_row][next_col] = boxType.LAND;\n                    }\n                    this.setLandFrame(next_row, next_col, boxType.HERO);\n                    let nt = this.palace[nextr][nextc];\n                    if(nt == boxType.BODY){\n                        this.palace[nextr][nextc] = boxType.ENDBOX;\n                        this.finishBoxCount += 1;\n                    }\n                    else {\n                        this.palace[nextr][nextc] = boxType.BOX;\n                    }\n                    this.setLandFrame(nextr, nextc, this.palace[nextr][nextc]);\n                    this.heroRow = next_row;\n                    this.heroCol = next_col;\n\n                    this.checkGameOver();\n                }\n            }\n        }\n    },\n    setLandFrame: function (row, col, type) {\n        let land = this.landArrays[row][col];\n        if (land) {\n            land.getComponent(cc.Sprite).spriteFrame = this.itemImgAtlas.getSpriteFrame(\"p\" + type);\n            land.width = this.boxW;\n            land.height = this.boxH;\n        }\n    },\n\n    checkGameOver() {\n        let count = this.allLevelConfig[this.curLevel].allBox;\n        if (this.finishBoxCount == count) {\n            this.gameOverLayer.active = true;\n            this.gameOverLayer.opacity = 1;\n            this.gameOverLayer.runAction(cc.sequence(\n                cc.delayTime(0.5),\n                cc.fadeIn(0.1)\n            ));\n\n            let finishLevel = parseInt(cc.sys.localStorage.getItem(\"finishLevel\") || 0);\n            if (this.curLevel > finishLevel) {\n                cc.sys.localStorage.setItem(\"finishLevel\", this.curLevel);\n            }\n\n            cc.sys.localStorage.setItem(\"levelStar\" + this.curLevel, 3);\n\n            let best = parseInt(cc.sys.localStorage.getItem(\"levelBest\" + this.curLevel) || 0);\n            if ((this.curStepNum < best) || (best == 0)) {\n                cc.sys.localStorage.setItem(\"levelBest\" + this.curLevel, this.curStepNum);\n            }\n            this.playSound(sound.GAMEWIN);\n            this.clearGameData();\n        }\n    },\n\n    setLevel: function () {\n        this.levelTxt.getComponent(cc.Label).string = this.curLevel;\n    },\n\n    setCurNum: function () {\n        this.curNum.getComponent(cc.Label).string = this.curStepNum;\n    },\n    setBestNum: function () {\n        let bestNum = cc.sys.localStorage.getItem(\"levelBest\" + this.curLevel) || \"--\";\n        this.bestNum.getComponent(cc.Label).string = bestNum;\n    },\n    clearGameData: function () {\n        this.finishBoxCount = 0;\n        this.curStepNum = 0;\n        this.curStepNum = 0;\n    },\n\n    playSound: function (name) {\n        cc.loader.loadRes(name, cc.AudioClip, function (err, clip) {\n            var audioID = cc.audioEngine.playEffect(clip, false);\n        });\n    },\n\n    start() {\n\n    },\n});"]}